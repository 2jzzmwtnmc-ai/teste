<script>
  const params = new URLSearchParams(window.location.search);
  const endParam = params.get("end");

  if (!endParam) {
    document.getElementById("contador").innerText = "parâmetro end ausente";
    throw new Error("end não informado");
  }

  // ✅ ISO 8601: YYYY-MM-DDTHH:mm:ss
  const endDate = new Date(endParam);

  if (isNaN(endDate.getTime())) {
    document.getElementById("contador").innerText = "data inválida";
    throw new Error("formato de data inválido");
  }

  function atualizar() {
    const now = new Date();
    let diffMs = endDate.getTime() - now.getTime();

    if (diffMs <= 0) {
      document.getElementById("contador").innerText = "0d 0h 0m 0s";
      return;
    }

    const totalSeconds = Math.floor(diffMs / 1000);

    const dias  = Math.floor(totalSeconds / 86400);
    const horas = Math.floor((totalSeconds % 86400) / 3600);
    const min   = Math.floor((totalSeconds % 3600) / 60);
    const seg   = totalSeconds % 60;

    document.getElementById("contador").innerText =
      `${dias}d ${horas}h ${min}m ${seg}s`;
  }

  atualizar();
  setInterval(atualizar, 1000);
</script>
